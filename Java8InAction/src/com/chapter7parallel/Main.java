package com.chapter7parallel;import java.util.Spliterator;import java.util.concurrent.ForkJoinPool;import java.util.concurrent.ForkJoinTask;import java.util.function.Function;import java.util.stream.IntStream;import java.util.stream.LongStream;import java.util.stream.Stream;import java.util.stream.StreamSupport;/** * Created by wangwenchao02 on 2017/8/22. */public class Main {    public static long measureSumPerf(Function<Long, Long> adder, long n) {        long fastest = Long.MAX_VALUE;        for (int i = 0; i < 10; i++) {            long start = System.nanoTime();            long sum = adder.apply(n);            long duration = (System.nanoTime() - start) / 1_000_000;            System.out.println("Result: " + sum);            if (duration < fastest) fastest = duration;        }        return fastest;    }    public static long forkJoinSum(long n) {        long[] num = LongStream.rangeClosed(1, n).toArray();        ForkJoinTask<Long> fjsc = new ForkJoinSumCalculator(num, 0, num.length);        return new ForkJoinPool().invoke(fjsc);    }    public static int countWord(String s) {        int counter = 0;        boolean lastSpace = true;        for (char c : s.toCharArray()) {            if (Character.isWhitespace(c)) {                lastSpace = true;            } else {                if (lastSpace) counter++;                lastSpace = false;            }        }        return counter;    }    public static int countWord(Stream<Character> s) {        WordCounter wc = s.parallel().reduce(new WordCounter(0, true),   // parallel 会造成分词, 因此统计会错误                WordCounter::accumulate,                WordCounter::combine);        return wc.getCounter();    }    public static void main(String[] args) {//        System.out.println(measureSumPerf(ParallelStreams::sequentialSum, 100_000_000));  // 62ms//        System.out.println(measureSumPerf(ParallelStreams::parallelSum, 100_000_000));    // 28ms        String sentence = " Nel   mezzo del cammin di nostra vita  mi   ritrovai in una   selva oscura  che la   "                + "dritta  via era    smarrita";        System.out.println(countWord(sentence));        Stream<Character> s = IntStream.range(0, sentence.length()).mapToObj(sentence::charAt);        System.out.println(countWord(s));        Spliterator<Character> spliterator = new WordCounterSpliterator(sentence);        Stream<Character> s2 = StreamSupport.stream(spliterator, true);        System.out.println(countWord(s2));    }}